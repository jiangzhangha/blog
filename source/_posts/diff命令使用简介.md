---
title: diff命令使用简介
date: 2020-07-07 21:35:27
categories: Linux知识
tags:
	- Linux
	- 命令工具
---

`diff`命令是`Linux`上比较重要的命令行工具，用于比较文本内容，并找到不相同的地方，`diff`在命令行中打印每一行的改动之处。`diff`程序的输出被称为补丁（`patch`），在`Linux`系统中还有一个`patch`程序，可以根据`diff`的输出，将文件内容更新为另一个文件内容，`diff`是版本控制工具不可或缺的一部分。



## 命令格式

~~~
diff [参数选项] [文件1 或者 目录1] [文件2 或者 目录2]
~~~



## 命令功能

`diff`命令能比较单个文件或者目录内容。

如果指定比较的是文件，则只有当输入为文本文件时才有效。以逐行的方式，比较文本文件的异同处。

如果指定比较的是目录的的时候，`diff `命令会比较两个目录下名字相同的文本文件。列出不同的二进制文件、公共子目录和只在一个目录出现的文件。



##  常用参数选项

| 参数选项                    | 作用                                                         |
| --------------------------- | ------------------------------------------------------------ |
|                             |                                                              |
| -a或--text                  | diff预设只会逐行比较文本文件                                 |
| -b或--ignore-space-change   | 不检查空格字符                                               |
| -B或--ignore-blank-lines    | 不检查空白行                                                 |
| -c                          | 显示全部内文，并标出不同之处                                 |
| -H或--speed-large-files     | 比较大文件时，可加快速度                                     |
| -l或--ignore-matching-lines | 若两个文件在某几行有所不同，而这几行同时都包含了选项中指定的字符或字符串，则不显示这两个文件的差异 |
| -i或--ignore-case           | 不检查大小写                                                 |
| -p                          | 若比较的文件为C语言的程序码文件时，显示差异所在的函数名称    |
| -q或--brief                 | 仅显示有无差异，不显示详细的信息                             |
| -r或--recursive             | 比较子目录中的文件                                           |
| -t或--expand-tabs           | 在输出时，将tab字符展开                                      |
| -T或--initial-tab           | 在每行前面加上tab字符以便对齐                                |
| -u,-U或--unified=           | 以合并的方式来显示文件内容的不同                             |
| -w或--ignore-all-space      | 忽略全部的空格字符                                           |
| -W或--width                 | 在使用-y参数时，指定栏宽                                     |
| -y或--side-by-side          | 以并列的方式显示文件的异同之处                               |
| --left-column               | 在使用-y参数时，若两个文件某一行内容相同，则仅在左侧的栏位显示该行内容 |
| --suppress-common-lines     | 在使用-y参数时，仅显示不同之处                               |



## 范例1：比较两个文件

~~~
[root@localhost test3]# diff log2014.log log2013.log 
3c3
< 2014-03
---
> 2013-03
8c8
< 2013-07
---
> 2013-08
11,12d10
< 2013-11
< 2013-12
~~~

`diff` 的`normal`显示格式有三种提示：

1. a -add
2. c - change
3. d - delete

上面的`“3c3”`和`“8c8”`表示`log2014.log`和`log20143.log`文件在3行和第8行内容有所不同；`"11,12d10"`表示第一个文件比第二个文件多了第11和12行。



## 范例2：并排格式输出

~~~
[root@localhost test3]# diff log2014.log log2013.log  -y -W 50
2013-01                 2013-01
2013-02                 2013-02
2014-03               | 2013-03
2013-04                 2013-04
2013-05                 2013-05
2013-06                 2013-06
2013-07                 2013-07
2013-07               | 2013-08
2013-09                 2013-09
2013-10                 2013-10
2013-11               <
2013-12               <
[root@localhost test3]# diff log2013.log log2014.log  -y -W 50
2013-01                 2013-01
2013-02                 2013-02
2013-03               | 2014-03
2013-04                 2013-04
2013-05                 2013-05
2013-06                 2013-06
2013-07                 2013-07
2013-08               | 2013-07
2013-09                 2013-09
2013-10                 2013-10
                      > 2013-11
                      > 2013-12
~~~

“|”表示前后2个文件内容有不同

“<”表示后面文件比前面文件少了1行内容

“>”表示后面文件比前面文件多了1行内容



## 范例3：上下文输出格式

~~~
[root@localhost test3]# diff log2013.log log2014.log  -c
*** log2013.log 2012-12-07 16:36:26.000000000 +0800
--- log2014.log 2012-12-07 18:01:54.000000000 +0800
***************
*** 1,10 ****
  2013-01
  2013-02
! 2013-03
  2013-04
  2013-05
  2013-06
  2013-07
! 2013-08
  2013-09
  2013-10
--- 1,12 ----
  2013-01
  2013-02
! 2014-03
  2013-04
  2013-05
  2013-06
  2013-07
! 2013-07
  2013-09
  2013-10
+ 2013-11
+ 2013-12[root@localhost test3]# diff log2014.log log2013.log  -c
*** log2014.log 2012-12-07 18:01:54.000000000 +0800
--- log2013.log 2012-12-07 16:36:26.000000000 +0800
***************
*** 1,12 ****
  2013-01
  2013-02
! 2014-03
  2013-04
  2013-05
  2013-06
  2013-07
! 2013-07
  2013-09
  2013-10
- 2013-11
- 2013-12
--- 1,10 ----
  2013-01
  2013-02
! 2013-03
  2013-04
  2013-05
  2013-06
  2013-07
! 2013-08
  2013-09
  2013-10[root@localhost test3]#
~~~

这种方式在开头两行作了比较文件的说明，这里有三中特殊字符：

“＋” 比较的文件的后者比前着多一行

“－” 比较的文件的后者比前着少一行

“！” 比较的文件两者有差别的行



## 范例4：统一格式输出

~~~
[root@localhost test3]# diff log2014.log log2013.log  -u
--- log2014.log 2012-12-07 18:01:54.000000000 +0800
+++ log2013.log 2012-12-07 16:36:26.000000000 +0800
@@ -1,12 +1,10 @@
 2013-01
 2013-02
-2014-03
+2013-03
 2013-04
 2013-05
 2013-06
 2013-07
-2013-07
+2013-08
 2013-09
 2013-10
-2013-11
-2013-12
~~~

它的第一部分，也是文件的基本信息：

`--- log2014.log 2012-12-07 18:01:54.000000000 +0800`

`+++ log2013.log 2012-12-07 16:36:26.000000000 +0800`

"---"表示变动前的文件，"+++"表示变动后的文件。

第二部分，变动的位置用两个@作为起首和结束。

　　 `@@ -1,12 +1,10 @@`

前面的`"-1,12"`分成三个部分：减号表示第一个文件（即`log2014.log`），"1"表示第1行，"12"表示连续12行。合在一起，就表示下面是第一个文件从第1行开始的连续12行。同样的，`"+1,10"`表示变动后，成为第二个文件从第1行开始的连续10行。